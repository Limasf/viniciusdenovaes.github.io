<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta name="generator" content="jemdoc, see http://jemdoc.jaboc.net/" />
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link rel="stylesheet" href="jemdoc.css" type="text/css" />
<title>Aula 04 - JDBC</title>
</head>
<body>
<table summary="Table for page layout." id="tlayout">
<tr valign="top">
<td id="layout-menu">
<div class="menu-category">Vinicius de Novaes Pereira</div>
<div class="menu-item"><a href="../../../../../index.html" class="current">home</a></div>
<div class="menu-category">Aulas</div>
<div class="menu-item"><a href="../../../../../class_unip.html">Unip</a></div>
</td>
<td id="layout-content">
<div id="toptitle">
<h1>Aula 04 - JDBC</h1>
<div id="subtitle"><a href="../../../../../index.html">Vinicius de Novaes Pereira</a></div>
</div>
<p>Nesta aula vamos aprender a fazer uma conexão com um banco de dados relacional (PostgreSQL).</p>
<p>Com a conexão, vamos aprender a atualizar e fazer pesquisa.</p>
<h2>Conexão</h2>
<p>Para fazer uma conexão com o Baco de Dados é preciso baixar o driver do banco de dados que será usado, neste caso usaremos o <a href="https://jdbc.postgresql.org/download.html">driver do Postgresql</a></p>
<p>Para criar uma <tt>Connection</tt> usaremos o método <tt>DriverManager.getConnection(URL, USER, PASSWORD)</tt> que receberá, a url do banco de dados, o nome de usuário e a senha.</p>
<p>Por exemplo, para conectar ao banco de dados &ldquo;NomeDoBancoDeDados&rdquo;, com o usuário &ldquo;postgres&rdquo;, e a senha &ldquo;123456&rdquo;.</p>
<div class="codeblock">
<div class="blockcontent"><pre>
public class TesteJDBC {

	public final static String DATABASE = "Teste";
	public final static String URL = "jdbc:postgresql:" + DATABASE;
	public final static String USER = "postgres";
	public final static String PASS = "123456";

	static public void fazConexao() {
		try(Connection connection = DriverManager.getConnection(URL, USER, PASS)){
			System.out.println("Conexao feita");
		} catch(SQLException e) {
			System.out.println("ERROR: Erro ao tentar conexao");
			e.printStackTrace();
		}

	}
}
</pre></div></div>
<h2>Atualização</h2>
<p>Para fazer uma atualização usaremos o método <tt>executeUpdate(String update)</tt> da classe <tt>Statement</tt>.
No lugar de <tt>update</tt> é preciso colocar o comando da atualização.</p>
<p>Para criar um <tt>Statement</tt> é preciso criar um pela conexão com o método <tt>connection.createStatement()</tt>.</p>
<p>Por exemplo, para adicionar um aluno com ra &ldquo;112&rdquo; e nome &ldquo;Fulano Sicrano&rdquo; na tabela abaixo</p>
<table class="imgtable"><tr><td>
<img src="tabelaAlunos.png" alt="" />&nbsp;</td>
<td align="left"></td></tr></table>
<div class="codeblock">
<div class="blockcontent"><pre>
	static public void addAluno() {

		final String update = "INSERT INTO alunos VALUES ('112', 'Fulano Sicrano')";


		try(Connection connection = DriverManager.getConnection(URL, USER, PASS)){

			Statement stm = connection.createStatement();
			int r = stm.executeUpdate(update);
			System.out.println("Linhas modificadas: " + r);

		} catch(SQLException e) {
			e.printStackTrace();
		}

	}
</pre></div></div>
<h2>Pesquisa</h2>
<p>Para fazer uma pesquisa usaremos o método <tt>executeQuery(String query)</tt> da classe <tt>Statement</tt>.
No lugar de <tt>query</tt> é preciso colocar o comando da pesquisa.</p>
<p>O método <tt>executeQuery</tt> retornará um objeto que implementa a interface <tt>ResultSet</tt>.</p>
<p>Para iterar sobre o <tt>ResultSet</tt> usaremos o método <tt>next()</tt>.</p>
<p>Para receber o valor da i-ésima coluna usaremos o método <tt>getXxx(int i)</tt>, 
ou podemos receber o valor da coluna de nome &ldquo;nome&rdquo; usando o método <tt>getXxx(String nome)</tt>.</p>
<p>Nestes casos <tt>Xxx</tt> deve ser substituído por </p>
<ul>
<li><p><tt>String</tt> caso o valor seja uma string, </p>
</li>
<li><p><tt>Int</tt> caso seja um número inteiro, e</p>
</li>
<li><p><tt>Double</tt> caso seja um número real.</p>
</li>
</ul>
<div class="codeblock">
<div class="blockcontent"><pre>
	static public void listaAlunos() {

		final String querry = "SELECT * FROM alunos";

		try(Connection connection = DriverManager.getConnection(URL, USER, PASS)){

			Statement stm = connection.createStatement();
			ResultSet rs = stm.executeQuery(querry);
			while(rs.next()) {
				System.out.println("ra: " + rs.getString(1) + ", nome: " + rs.getString(2));
			}

		} catch(SQLException e) {
			e.printStackTrace();
		}

	}
</pre></div></div>
<h2>PreparedStatement (<b><a style="color:red;">IMPORTANTE!!!</a></b>)</h2>
<p>Raramente iremos precisar fazer uma atualização ou uma busca usando argumentos pré-programados. 
Normalmente é o usuário final quem deve fornecer quais argumentos usar na nossa busca ou atualização.</p>
<p>Neste caso <b>nunca</b> devemos concatenar uma String de um comando com uma String fornecida pelo usuário.
Sob o risco do sistema sofrer um <a href="https://en.wikipedia.org/wiki/SQL_injection"><i><b>injection atack</b></i></a>.</p>
<p>O recomendável para esta situação é usar a classe <tt>PreparedStatement</tt></p>
<p>Um objeto que implementa a interface <tt>PreparedStatement</tt> é retornado pelo método <tt>connection.prepareStatement(String query)</tt>.
A <tt>String query</tt> que o método recebe deve ter o símbolo <tt>&rsquo;?&rsquo;</tt> no lugar onde o argumento será inserido no comando SQL.</p>
<p>Para inserir um valor na <tt>query</tt> é preciso usar o método <tt>setXxx(int i, Xxx x)</tt>; 
onde <tt>Xxx</tt> será <tt>String</tt>, <tt>Double</tt> ou <tt>Int</tt>; 
<tt>i</tt> para indicar qual i-ésimo &rsquo;?&rsquo; será substituído; 
<tt>x</tt> com o valor que deve entrar no lugar.</p>
<div class="codeblock">
<div class="blockcontent"><pre>
	static public void addAluno(String ra, String nome) {

		final String query = "INSERT INTO alunos VALUES (?, ?)";


		try(Connection connection = DriverManager.getConnection(URL, USER, PASS)){

			PreparedStatement pstm = connection.prepareStatement(query);
			pstm.setString(1, ra);
			pstm.setString(2, nome);
			int r = pstm.executeUpdate();
			System.out.println("Linhas modificadas: " + r);

		} catch(PSQLException e) {
			System.out.println(e.getMessage());
		} catch(SQLException e) {
			e.printStackTrace();
		}
	}
</pre></div></div>
<div class="codeblock">
<div class="blockcontent"><pre>

	static public void buscaAluno(String nome) {

		final String query = "SELECT * FROM alunos WHERE nome = ?";

		try(Connection connection = DriverManager.getConnection(URL, USER, PASS)){

			PreparedStatement pstm = connection.prepareStatement(query);
			pstm.setString(1, nome);
			ResultSet rs = pstm.executeQuery();
			while(rs.next()) {
				System.out.println("ra: " + rs.getString(1) + ", nome: " + rs.getString(2));
			}

		} catch(SQLException e) {
			e.printStackTrace();
		}

	}
</pre></div></div>
<div id="footer">
<div id="footer-text">
Page generated 2019-09-02 00:19:13 -03, by <a href="http://jemdoc.jaboc.net/">jemdoc</a>.
</div>
</div>
</td>
</tr>
</table>
</body>
</html>
